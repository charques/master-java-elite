DROP TABLE UNIT IF EXISTS;
DROP TABLE FEEDSTOCK IF EXISTS;
DROP TABLE RECIPE IF EXISTS;
DROP TABLE INGREDIENT IF EXISTS;
DROP TABLE BATCH IF EXISTS;
DROP TABLE BATCH_INGREDIENT IF EXISTS;

CREATE TABLE UNIT (
    ID integer generated by default as identity (start with 1) not null,  
    DESCRIPTION varchar(50) not null,
	CREATION_TIME timestamp not null,
	CONSTRAINT IDX_UNIT_ID PRIMARY KEY (ID)
);

CREATE TABLE FEEDSTOCK (
    ID integer generated by default as identity (start with 1) not null,
    DESCRIPTION varchar(50) not null,
    PRICE decimal(7,3) not null,
    UNIT_ID integer not null,
	CREATION_TIME timestamp not null,
	MODIFICATION_TIME timestamp not null,
    CONSTRAINT IDX_FEEDSTOCK_ID PRIMARY KEY (ID),
    CONSTRAINT FK_FEEDSTOCK__UNIT_ID FOREIGN KEY (UNIT_ID) REFERENCES UNIT(ID) on delete cascade
);

CREATE TABLE RECIPE (
    ID integer generated by default as identity (start with 1) not null,
    DESCRIPTION varchar(50) not null,
    COMMENT varchar(50) not null,
	CREATION_TIME timestamp not null,
	MODIFICATION_TIME timestamp not null,
    CONSTRAINT IDX_RECIPE_ID PRIMARY KEY (ID)
);

CREATE TABLE INGREDIENT (
    ID integer generated by default as identity (start with 1) not null,
    RECIPE_ID integer not null,
    FEEDSTOCK_ID integer not null,
    PERCENTAGE integer not null,
	CREATION_TIME timestamp not null,
	MODIFICATION_TIME timestamp not null,
    CONSTRAINT IDX_INGREDIENT_ID PRIMARY KEY (ID),
    CONSTRAINT FK_INGREDIENT__RECIPE_ID FOREIGN KEY (RECIPE_ID) REFERENCES RECIPE(ID) on delete cascade,
    CONSTRAINT FK_INGREDIENT__FEEDSTOCK_ID FOREIGN KEY (FEEDSTOCK_ID) REFERENCES FEEDSTOCK(ID)
);

CREATE TABLE BATCH (
    ID integer generated by default as identity (start with 1) not null,  
    DESCRIPTION varchar(50) not null,
    RECIPE_ID integer not null,
    TOTAL_AMOUNT float not null,
    BATCH_COST decimal(7,3) not null,
	CREATION_TIME timestamp not null,
	MODIFICATION_TIME timestamp not null,
	CONSTRAINT IDX_BATCH_ID PRIMARY KEY (ID),
	CONSTRAINT FK_BATCH__RECIPE_ID FOREIGN KEY (RECIPE_ID) REFERENCES RECIPE(ID)
);

CREATE TABLE BATCH_INGREDIENT (
    ID integer generated by default as identity (start with 1) not null,  
    BATCH_ID integer not null,
    DESCRIPTION varchar(50) not null,
    AMOUNT float not null,
    PERCENTAGE integer not null,
    FEEDSTOCK_PRICE decimal(7,3) not null,
	CREATION_TIME timestamp not null,
	MODIFICATION_TIME timestamp not null,
	CONSTRAINT IDX_BATCH_INGREDIENT_ID PRIMARY KEY (ID),
	CONSTRAINT FK_BATCH_INGREDIENT__BATCH_ID FOREIGN KEY (BATCH_ID) REFERENCES BATCH(ID) on delete cascade
);

INSERT INTO UNIT(ID, DESCRIPTION, CREATION_TIME) VALUES(1, 'GRAMO', NOW());
INSERT INTO UNIT(ID, DESCRIPTION, CREATION_TIME) VALUES(2, 'CENTILITRO', NOW());

INSERT INTO FEEDSTOCK(ID, DESCRIPTION, PRICE, UNIT_ID, CREATION_TIME, MODIFICATION_TIME) VALUES(1, 'HARINA FUERZA', 0.01, 1, NOW(), NOW());
INSERT INTO FEEDSTOCK(ID, DESCRIPTION, PRICE, UNIT_ID, CREATION_TIME, MODIFICATION_TIME) VALUES(2, 'HARINA BLANCA', 0.01, 1, NOW(), NOW());
INSERT INTO FEEDSTOCK(ID, DESCRIPTION, PRICE, UNIT_ID, CREATION_TIME, MODIFICATION_TIME) VALUES(3, 'HARINA T80', 0.01, 1, NOW(), NOW());
INSERT INTO FEEDSTOCK(ID, DESCRIPTION, PRICE, UNIT_ID, CREATION_TIME, MODIFICATION_TIME) VALUES(4, 'AGUA', 0.01, 2, NOW(), NOW());
INSERT INTO FEEDSTOCK(ID, DESCRIPTION, PRICE, UNIT_ID, CREATION_TIME, MODIFICATION_TIME) VALUES(5, 'MALTA', 0.02, 1, NOW(), NOW());
INSERT INTO FEEDSTOCK(ID, DESCRIPTION, PRICE, UNIT_ID, CREATION_TIME, MODIFICATION_TIME) VALUES(6, 'HARINA CENTENO BLANCO', 0.03, 1, NOW(), NOW());
INSERT INTO FEEDSTOCK(ID, DESCRIPTION, PRICE, UNIT_ID, CREATION_TIME, MODIFICATION_TIME) VALUES(7, 'MASA MADRE', 0.03, 1, NOW(), NOW());
INSERT INTO FEEDSTOCK(ID, DESCRIPTION, PRICE, UNIT_ID, CREATION_TIME, MODIFICATION_TIME) VALUES(8, 'SAL', 0.03, 1, NOW(), NOW());
INSERT INTO FEEDSTOCK(ID, DESCRIPTION, PRICE, UNIT_ID, CREATION_TIME, MODIFICATION_TIME) VALUES(9, 'LEVADURA', 0.03, 1, NOW(), NOW());

INSERT INTO RECIPE(ID, DESCRIPTION, COMMENT, CREATION_TIME, MODIFICATION_TIME) VALUES (1, 'CLASICO', 'Pan cl‡sico', NOW(), NOW());
INSERT INTO RECIPE(ID, DESCRIPTION, COMMENT, CREATION_TIME, MODIFICATION_TIME) VALUES (2, 'SEMILLAS', 'Pan de semillas', NOW(), NOW());
INSERT INTO RECIPE(ID, DESCRIPTION, COMMENT, CREATION_TIME, MODIFICATION_TIME) VALUES (3, 'ESPELTA', 'Pan de espelta', NOW(), NOW());

INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (1, 1, 1, 80, NOW(), NOW());
INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (2, 1, 2, 2, NOW(), NOW());
INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (3, 1, 3, 13, NOW(), NOW());
INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (4, 1, 4, 68, NOW(), NOW());
INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (5, 1, 5, 1, NOW(), NOW());
INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (6, 2, 1, 80, NOW(), NOW());
INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (7, 2, 2, 2, NOW(), NOW());
INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (8, 2, 3, 13, NOW(), NOW());
INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (9, 2, 6, 7, NOW(), NOW());
INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (10, 2, 8, 10, NOW(), NOW());
INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (11, 3, 1, 45, NOW(), NOW());
INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (12, 3, 2, 13, NOW(), NOW());
INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (13, 3, 5, 7, NOW(), NOW());
INSERT INTO INGREDIENT(ID, RECIPE_ID, FEEDSTOCK_ID, PERCENTAGE, CREATION_TIME, MODIFICATION_TIME) VALUES (14, 3, 7, 20, NOW(), NOW());

INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (1, 'CLASICO - 01/11/2011', 1, 1500, 45.2, NOW(), TO_DATE('2011-11-01', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (2, 'CLASICO - 01/12/2011', 1, 4000, 103.4, NOW(), TO_DATE('2011-12-01', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (3, 'SEMILLAS - 01/04/2012', 2, 2232, 60.9, NOW(), TO_DATE('2012-04-01', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (4, 'SEMILLAS - 05/04/2012', 2, 2333, 62.4, NOW(), TO_DATE('2012-04-05', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (5, 'ESPELTA - 04/05/2012', 3, 6754, 134.5, NOW(), TO_DATE('2012-05-04', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (6, 'CLASICO - 12/05/2012', 1, 4532, 87.7, NOW(), TO_DATE('2012-05-12', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (7, 'CLASICO - 03/06/2012', 1, 1532, 77.7, NOW(), TO_DATE('2012-06-03', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (8, 'CLASICO - 16/06/2012', 1, 4532, 50.7, NOW(), TO_DATE('2012-06-16', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (9, 'ESPELTA - 12/08/2012', 3, 4532, 12.7, NOW(), TO_DATE('2012-08-12', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (10, 'CLASICO - 12/09/2012', 1, 2532, 47.7, NOW(), TO_DATE('2012-09-12', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (11, 'ESPELTA - 05/10/2012', 3, 5332, 87.5, NOW(), TO_DATE('2012-10-05', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (12, 'SEMILLAS - 12/10/2012', 2, 1532, 87.7, NOW(), TO_DATE('2012-10-12', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (13, 'CLASICO - 01/11/2012', 1, 2532, 37.4, NOW(), TO_DATE('2012-11-01', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (14, 'SEMILLAS - 12/11/2012', 2, 3532, 87.2, NOW(), TO_DATE('2012-11-12', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (15, 'CLASICO - 15/12/2012', 1, 4552, 53.7, NOW(), TO_DATE('2012-12-15', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (16, 'CLASICO - 15/01/2013', 1, 3552, 53.2, NOW(), TO_DATE('2013-01-15', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (17, 'SEMILLAS - 11/02/2013', 2, 4880, 43.3, NOW(), TO_DATE('2013-02-11', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (18, 'ESPELTA - 15/02/2013', 3, 6003, 66.5, NOW(), TO_DATE('2013-02-15', 'YYYY-MM-DD'));
INSERT INTO BATCH(ID, DESCRIPTION, RECIPE_ID, TOTAL_AMOUNT, BATCH_COST, CREATION_TIME, MODIFICATION_TIME) VALUES (19, 'SEMILLAS - 15/03/2013', 2, 7829, 145.9, NOW(), TO_DATE('2013-03-15', 'YYYY-MM-DD'));
